<html>
	<head>
		<title>Tool Lending</title>
		<script type="text/javascript" src="js/ICanHaz.js"></script>
		<script src='http://api.tiles.mapbox.com/mapbox.js/v1.0.0/mapbox.js'></script>
		<script src='js/jquery.js '></script>
		<script type="text/javascript" src='js/d3.js'></script>
		<script type="text/javascript" src='js/sheetsee.js'></script>
		<link rel="shortcut icon" href="https://raw.github.com/jllord/sheetsee-cache/master/favicon-p.png"/>


    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.0.0/mapbox.css' rel='stylesheet' />
		<link media="screen" rel="stylesheet" type="text/css" href="/css/style.css">
		<link media="screen" rel="stylesheet" type="text/css" href="/css/site.css">
	</head>
	<body>
		<header class="container">
			<h1>Tool Lending</h1>
		</header>
		<div id="filters" class="container">
			<input id="toolSearch" type="text" placeholder="hammer.."></input>
			<span class="clear sml-button">Clear</span>
			<span id="showAvailable" class="sml-button">Show Available</span>
		</div>
		<div id="tools" class="container"></div>
		<div id="info" class="container">
				<div class="span1">
					<h4>THE DATA</h4>
					<p>The data fueling this website is managed through <a href="https://docs.google.com/spreadsheet/ccc?key=0AvFUWxii39gXdGxhcjhzYzlBX2pyVFZZU2VjZ3BHZ3c&usp=sharing" target="_blank">this Google Spreadsheet</a>. If you've been invited by the person who initated this near you, you'll have access and the ability to edit the rows. If you want to start your own for your neighborhood or group of friends, see details below.</p>
				</div>

				<div class="span1">
					<h4>THE SITE</h4>
					<p>This site takes data from a Google Spreadsheet, visualizes it and makes it easy to see and use on a computer or a smartphone - it uses. It's an open source project created by <a href="mailto:jlord@github.com">Jessica Lord</a>. . Visualizing the spreadsheet data happens with . Setting up your own instance of this website is free and takes just a few steps. Those steps and source for this project are on <a href="http://www.github.com/sheetsee-tool-lending" target="_blank">GitHub</a>.</p>
				</div>
		</div>

		<script id="tools" type="text/html">
		{{#rows}}
		<div id="{{rowNumber}}" class="tool-box">
			<span class="tool-box-tool">{{tool}}</span>
			<div class="tool-box-bottom {{rowNumber}}">
				{{^checkedout}}<a href="mailto:{{owneremail}}?subject=Tool Lending: {{tool}}"><span class="tool-box-borrow btn">BORROW</span></a>{{/checkedout}}
				<ul>
					<li><a href="mailto:{{owneremail}}">{{owner}}</a></li>
					<li>{{street}}, {{city}}, {{state}} <a href="https://maps.google.com/maps?q={{street}},{{city}},{{state}}" target="_blank"><small>MAP</small></a></li>
					{{#tooldetails}}<li><em>notes: {{tooldetails}}</em></li>{{/tooldetails}}
				</ul>
			</div>
		</div>
		{{/rows}}
		</script>

		<script type="text/javascript">
	  document.addEventListener('DOMContentLoaded', function() {
	  	// original tool boxes
	  	drawToolBox(gData)
	  })

  	function drawToolBox(data) {
  		var tools = ich.tools({
  			"rows": data
  		})
  		$('#tools').html(tools)
  	}

		// toggle available/all tools with search as well
		$('#showAvailable').live("click", function(event) {
			var searchValue = $('#toolSearch').val()
			if ($(this).hasClass('button-pressed')) {
				$(this).removeClass('button-pressed').removeClass('onlyAvailable').html('Show Available')
				if (!searchValue) drawToolBox(gData)
				toolsFromSearch(searchValue)
			}
			else {
				$(this).addClass('button-pressed').addClass('onlyAvailable').html('Show All')
				if (!searchValue) {
					var availableTools = Sheetsee.getMatches(gData,"yes", "checkedout")
					drawToolBox(availableTools)
				}
				else {
					var searchResults = Sheetsee.getKeyword(gData, searchValue)
					var availableFromSearch = Sheetsee.getMatches(searchResults,"yes", "checkedout")
					drawToolBox(availableFromSearch)
				}
			}
		})

	  // toggle tool box expand
	  $('.tool-box-tool').live("click", function(event) {
   		var rowNumber = $(this).closest("div").attr("id")
   		if ($(this).closest('div').hasClass('selected-tool')) {
   			$('.tool-box-bottom' + '.' + rowNumber).css('display', 'none')
   			$(this).closest('div').removeClass('selected-tool')
   		}
   		else {
   			$('.tool-box-bottom' + '.' + rowNumber).css('display', 'inherit')
   			$(this).closest('div').addClass('selected-tool')
   		}
   	})
   	// filter input
	  $('.clear').on("click", function() {
	    $(this.id + "#toolSearch").val("")
	    drawToolBox(gData)
	  })

    $('#toolSearch').keyup(function(e) {
      var text = $(e.target).val()
			toolsFromSearch(text)
  	})

		function toolsFromSearch(searchTerm) {
			var searchedData = Sheetsee.getKeyword(gData, searchTerm)
			drawToolBox(searchedData)
		}
		</script>
	</body>
</html>
